package Core

import (
	"Mule/utils"
	"net/url"
	"regexp"
	"strings"
)

var AWSS3 = regexp.MustCompile(`(?i)[a-z0-9.-]+\.s3\.amazonaws\.com|[a-z0-9.-]+\.s3-[a-z0-9-]\.amazonaws\.com|[a-z0-9.-]+\.s3-website[.-](eu|ap|us|ca|sa|cn)|//s3\.amazonaws\.com/[a-z0-9._-]+|//s3-[a-z0-9-]+\.amazonaws\.com/[a-z0-9._-]+`)

var linkFinderRegex = regexp.MustCompile(`(?:"|')(((?:[a-zA-Z]{1,10}://|//)[^"'/]{1,}\.[a-zA-Z]{2,}[^"']{0,})|((?:/|\.\./|\./)[^"'><,;| *()(%%$^/\\\[\]][^"'><,;|()]{1,})|([a-zA-Z0-9_\-/]{1,}/[a-zA-Z0-9_\-/]{1,}\.(?:[a-zA-Z]{1,4}|action)(?:[\?|#][^"|']{0,}|))|([a-zA-Z0-9_\-/]{1,}/[a-zA-Z0-9_\-/]{3,}(?:[\?|#][^"|']{0,}|))|([a-zA-Z0-9_\-]{1,}\.(?:php|asp|aspx|jsp|json|action|html|js|txt|xml)(?:[\?|#][^"|']{0,}|)))(?:"|')`)
var linkFinderPass = regexp.MustCompile(`(/\w+\.(.)*(\.css)+)|(/\w+\.svg)|(/\w+\.jpg)|(/\w+\.png)|(/[\w\-]+\.vue)|(chunk-\w+\.\w+(\.js)+)`)

var JsBlackList = []string{"vue.cjs.js", "umd/react-is.production.min.js", "umd/react.production.min.js", "umd/react-dom.production.min.js", "create-react-class.min.js", "js/bootstrap.min.js", "js/bootstrap.min.js", "d3.min.js", "axios.min.js", "core.umd.min.js", "antd.min.js", "typescript.min.js", "index.js", "three.min.js", "css/all.min.css", "animate.min.css", "fira_code.css", "angular-animate.min.js", "angular-aria.min.js", "angular-cookies.min.js", "angular-locale_en-us.min.js", "angular-loader.min.js", "angular-message-format.min.js", "angular-messages.min.js", "angular-parse-ext.min.js", "angular-resource.min.js", "angular-route.min.js", "angular-sanitize.min.js", "angular-touch.min.js", "angular.min.js", "reveal.js", "redux.min.js", "chart.min.js", "socket.io.js", "jquery.min.js", "tailwind.min.css", "jquery.min.js", "index.js", "echarts.min.js", "semantic.min.js", "lodash.min.js", "js/ionic.min.js", "react-router-dom.development.js", "react-router.development.js", "moment.min.js", "css/bulma.min.css", "iconfont/material-icons.min.css", "standalone.js", "kotlin.js", "mermaid.min.js", "js/adminlte.min.js", "normalize.min.css", "dayjs.min.js", "css/materialize.min.css", "pdf.min.js", "polyfill.min.js", "browser.js", "browser.min.js", "anime.min.js", "styled-components.min.js", "impress.min.js", "cjs/pixi.min.js", "vuetify.min.js", "leaflet.js", "video.min.js", "fullpage.min.js", "gulp.min.js", "clipboard.min.js", "material.min.js", "phaser.min.js", "immutable.min.js", "preact.min.js", "js/jquery.fileupload.min.js", "swiper-bundle.min.js", "shim.min.js", "js/foundation.min.js", "js/foundation.min.js", "min/vs/editor/editor.main.js", "backbone-min.js", "date_fns.min.js", "signalr.min.js", "quill.min.js", "async.min.js", "marked.min.js", "rxjs.umd.min.js", "vuex.min.js", "ant-design-pro.min.js", "lottie.min.js", "lottie.min.js", "underscore-min.js", "webtorrent.min.js", "slick.min.js", "style/weui.min.css", "xls.min.js", "html2canvas.min.js", "modernizr.min.js", "uppy.min.js", "mobx.umd.production.min.js", "mobxreact.umd.production.min.js", "mobxreactlite.umd.production.min.js", "index.js", "js/select2.min.js", "fetch.min.js", "codemirror.min.js", "tesseract.min.js", "react-select.cjs.js", "index.js", "layui.js", "jspdf.umd.min.js", "iview.min.js", "css/hover-min.css", "nprogress.min.js", "Sortable.min.js", "web.cjs.js", "particles.min.js", "fastify.js", "pure-min.css", "ember.debug.js", "chosen.jquery.min.js", "mdb.min.js", "immer.umd.production.min.js", "client.min.js", "bundle.js", "signalr.min.js", "react-redux.min.js", "swagger-ui.js", "hammer.min.js", "ramda.min.js", "polymer-element.js", "rollup.browser.js", "mocha.min.js", "fabric.min.js", "intro.min.js", "sweetalert.min.js", "plyr.min.js", "redux-saga.umd.min.js", "react-virtualized.min.js", "react-bootstrap.min.js", "photoswipe.min.js", "umd/popper.min.js", "flv.min.js", "bootstrap-material-design.umd.min.js", "dragula.min.js", "cdn.js", "index.js", "highlight.min.js", "jade.min.js", "js/custom.min.js", "scrollreveal.min.js", "docsify.min.js", "localforage.min.js", "vant.min.js", "bluebird.min.js", "js.cookie.min.js", "react-motion.js", "feather.min.js", "index.js", "Draft.min.js", "vue-router.cjs.js", "howler.min.js", "popmotion.cjs.min.js", "validator.min.js", "core.bundle.js", "styles/main.min.css", "skrollr.min.js", "reselect.min.js", "fastclick.min.js", "editor.js", "skeleton.min.css", "Recharts.min.js", "spinkit.min.css", "js/uikit.min.js", "mo.min.js", "Flux.min.js", "rxdb.browserify.min.js", "cjs/index.min.js", "p5.min.js", "redux-thunk.min.js", "relay.min.js", "velocity.min.js", "jquery.pjax.min.js", "js/framework7.min.js", "trix.js", "less.min.js", "minified.js", "low.min.js", "antd.min.js", "typeahead.bundle.min.js", "babylon.js", "material-components-web.min.js", "quasar.mat.umd.min.js", "fingerprint2.min.js", "dropzone.min.js", "piwik.js", "tf.min.js", "mint-ui.common.min.js", "bokeh.min.js", "cleave.min.js", "coffeescript.js", "superagent.min.js", "index.browser.js", "esm/ionicons.min.js", "handlebars.min.js", "tooltip.min.js", "gun.min.js", "FileSaver.min.js", "mock-min.js", "jasmine.min.js", "grapes.min.js", "pace.min.js", "react-grid-layout.min.js", "css/nes.min.css", "inferno.min.js", "inferno-compat.min.js", "inferno-component.min.js", "inferno-create-class.min.js", "inferno-create-element.min.js", "inferno-devtools.min.js", "inferno-hyperscript.min.js", "inferno-mobx.min.js", "inferno-redux.min.js", "inferno-router.min.js", "inferno-server.min.js", "inferno-shared.min.js", "inferno-test-utils.min.js", "inferno-vnode-flags.min.js", "aframe-ar.min.js", "lazysizes.min.js", "katex.min.js", "handsontable.full.min.js", "q.min.js", "masonry.pkgd.min.js", "parallax.min.js", "flatpickr.min.js", "zepto.min.js", "css/flat-ui.min.css", "better-scroll.min.js", "Recompose.min.js", "js/medium-editor.min.js", "core/main.min.js", "draggable.min.js", "index.full.js", "riot.min.js", "ui-bootstrap.js", "mustache.min.js", "plotly.min.js", "rough.js", "js/ratchet.min.js", "react-table.min.js", "vconsole.min.js", "sweetalert2.min.js", "jquery.handsontable.full.min.js", "core.umd.min.js", "frappe-charts.min.css", "Helmet.js", "index.js", "web3.min.js", "index.min.js", "aos.js", "angular-ui-router.min.js", "aframe.min.js", "web/hack.min.css", "vivus.min.js", "css-layout.min.js", "ScrollMagic.min.js", "gpu.min.js", "js/amazeui.min.js", "fuse.min.js", "phonenumberutil.min.js", "pouchdb.min.js", "gsap.min.js", "graphiql.min.js", "vuedraggable.umd.js", "iosevka/iosevka.min.css", "cerulean/bootstrap.min.css", "darkreader.js", "store.modern.js", "wangEditor.min.js", "fluentui-react.min.js", "index.js", "css/froala_blocks.min.css", "js/mui.min.js", "snap.svg-min.js", "simpleicons.svg", "markdown-it.min.js", "bootstrap-vue.min.js", "turbolinks.js", "semantic-ui-react.min.js", "redux-form.min.js", "require.min.js", "js/selectize.min.js", "xterm.min.js", "iscroll.min.js", "brain-browser.min.js", "matter.min.js", "mithril.min.js", "react-json-tree.min.js", "showdown.min.js", "chartist.min.js", "paper-full.min.js", "js/bootstrap-datepicker.min.js", "luxon.min.js", "math.js", "omi.min.js", "react-intl.min.js", "system.min.js", "jimp.min.js", "nedb.min.js", "smartcrop.min.js", "tui-editor-Editor.min.js", "driver.min.js", "filepond.min.js", "crypto-js.min.js", "respond.min.js", "Tone.js", "zxcvbn.js", "remark.min.js", "card.min.js", "pell.min.js", "index.min.js", "apexcharts.min.js", "g2.min.js", "hls.min.js", "jquery.magnific-popup.min.js", "bootstrap-table.min.js", "tinymce.min.js", "primer.css", "index.js", "jquery-ui.min.js", "raphael.min.js", "native.history.min.js", "headroom.min.js", "typed.min.js", "workbox-sw.js", "redux-persist.min.js", "ajv7.min.js", "highcharts.js", "toastr.min.js", "summernote.min.js", "papaparse.min.js", "list.min.js", "spectre.min.css", "uuid.min.js", "mousetrap.min.js", "reactstrap.umd.js", "cropper.min.js", "noframework.waypoints.min.js", "editormd.min.js", "tachyons.min.css", "jquery.validate.min.js", "isotope.pkgd.min.js", "vue-resource.min.js", "picturefill.min.js", "interact.min.js", "peerjs.min.js", "convnet-min.js", "prism.min.js", "blockly.min.js", "antd-mobile.min.js", "falcor.all.min.js", "nlp_compromise.min.js", "jquery.mobile.min.js", "snabbdom.min.js", "knockout-latest.js", "pdfmake.min.js", "daterangepicker.min.js", "DPlayer.min.js", "html5shiv.min.js", "trianglify.min.js", "cycle.min.js", "loaders.min.css", "vega.min.js", "tui-calendar.min.js", "highmaps.js", "highstock.js", "sigma.min.js", "muuri.min.js", "index.js", "es5/umd/single-spa.min.cjs", "jquery.onepage-scroll.min.js", "full.css", "js/shepherd.min.js", "js/shepherd.min.js", "js/mdb.min.js", "css/photon.min.css", "victory.min.js", "svg.min.js", "jsoneditor.min.js", "react-sortable-hoc.min.js", "spin.min.js", "wow.min.js", "tippy.umd.min.js", "react-slick.min.js", "iconfont/tabler-icons.min.css", "eruda.min.js", "qrcode.min.js", "sql-wasm.js", "buefy.min.js", "index.js", "is.min.js", "boardgameio.min.js", "js/bootstrap-select.min.js", "flexboxgrid.min.css", "parsley.min.js", "color-thief.min.js", "quicklink.js", "vee-validate.min.js", "milligram.min.css", "sinon.min.js", "react-jsonschema-form.js", "c3.min.js", "js/sb-admin-2.min.js", "js/colors.min.js", "colors.min.css", "index.js", "g6.min.js", "jshint.min.js", "jquery.cookie.min.js", "aws-amplify.min.js", "_mixins.scss", "imagesloaded.pkgd.min.js", "perfect-scrollbar.min.js", "perfect-scrollbar.min.js", "offline.min.js", "chroma.min.js", "tracking-min.js", "jquery.signalR.min.js", "jquery.lazyload.min.js", "deeplearn.min.js", "react-markdown.js", "gremlins.min.js", "react-transition-group.min.js", "purify.min.js", "favico.min.js", "numeral.min.js", "js/tether.min.js", "jquery.lazyload.min.js", "mapbox-gl.js", "barba.min.js", "webfontloader.js", "Cesium.js", "wired-elements-esm.js", "es5/startup.js", "push.min.js", "json2.min.js", "js/onsenui.min.js", "cytoscape.min.js", "muse-ui.common.js", "fine-uploader.min.js", "hint.min.css", "ag-grid-community.min.js", "tween.umd.js", "sea.js", "restangular.min.js", "layer.js", "brain.min.js", "exceljs.min.js", "ng-file-upload-shim.min.js", "satellizer.min.js", "vis.min.js", "slideout.min.js", "ReactRouterRedux.min.js", "ng-bootstrap.umd.min.js", "acorn-loose.js", "acorn.min.js", "sockjs.min.js", "css/flag-icons.min.css", "grommet.min.js", "cropper.min.js", "mediaelement.min.js", "flowchart.min.js", "ladda.min.js", "picker.js", "signature_pad.min.js", "mailcheck.min.js", "easeljs.min.js", "rax.min.js", "dexie.min.js", "walk.js", "state-machine.min.js", "history.development.js", "two.min.js", "icheck.min.js", "chai.min.js", "ink.min.css", "markdown.min.js", "radium.min.js", "jquery.transit.min.js", "index.js", "metricsgraphics.min.js", "foundation-emails.min.css", "flexsearch.es5.js", "fesm2015/primeng.mjs.map", "nunjucks.min.js", "driver-dom.min.js", "ol.js", "ol.js", "sequence-diagram-min.js", "beautify.min.js", "dynamics.min.js", "konva.min.js", "progressbar.min.js", "owl.carousel.min.js", "dc.min.js", "playcanvas.min.js", "magic.min.css", "backbone.marionette.min.js", "page.js", "countUp.min.js", "gmaps.min.js", "es5-shim.min.js", "lunr.min.js", "jszip.min.js", "nv.d3.min.js", "pikaday.min.js", "es6-promise.min.js", "odometer.min.js", "vue-lazyload.js", "clusterize.min.js", "flickity.pkgd.min.js", "aws-sdk.min.js", "morris.min.js", "js/tempus-dominus.js", "js/tempus-dominus.js", "mqtt.min.js", "js/vex.min.js", "swipe.min.js", "htm.js", "jquery.fancybox.min.js", "js/bootstrap-datetimepicker.min.js", "jquery.noty.min.js", "infinite-scroll.pkgd.min.js", "qs.min.js", "jquery.fittext.min.js", "synaptic.min.js", "noty.min.js", "awesomplete.min.js", "index.cjs.js", "js/metro.min.js", "Stats.min.js", "react-modal.min.js", "fetch-npm-browserify.min.js", "moveable.min.js", "flight.min.js", "ZeroClipboard.min.js", "js/jquery.dataTables.min.js", "hamburgers.min.css", "wysihtml5.min.js", "vue-i18n.cjs.js", "rsuite.min.js", "jss.min.js", "jquery.adaptive-backgrounds.min.js", "loadCSS.min.js", "js/jsplumb.min.js", "rickshaw.min.js", "bundle.min.js", "dom-to-image.min.js", "index.min.js", "bootstrap-editable/js/bootstrap-editable.min.js", "lovefield.min.js", "react-datepicker.min.js", "sjcl.min.js", "lozad.min.js", "screenfull.min.js", "keymaster.min.js", "viewer.min.js", "react-move.min.js", "ort.min.js", "Bacon.min.js", "build.css", "turn.min.js", "glide.min.js", "elevator.min.js", "shoelace.css", "crossfilter.min.js", "ua-parser.min.js", "index.js", "bundle.umd.min.js", "clmtrackr.min.js", "esprima.min.js", "bundle.min.js", "bundle.tracing.min.js", "turf.min.js", "jquery.gridster.min.js", "URI.min.js", "notie.min.js", "js/intlTelInput.min.js", "bounce.min.js", "i18next.min.js", "elm-runtime.min.js", "pinia.iife.js", "snap.min.js", "simplepeer.min.js", "wavesurfer.min.js", "lazyload.min.js", "js/uswds.min.js", "clarity-icons.min.js", "clarity-ui.min.css", "fastdom.min.js", "dat.gui.min.js", "sizzle.min.js", "htmx.min.js", "go.js", "lazy.min.js", "jquery.flot.js", "angular-strap.min.js", "github-markdown.min.css", "annyang.min.js", "css/weather-icons.min.css", "ractive.min.js", "bootstrap-icons.svg", "avalon.min.js", "cash.min.js", "holder.min.js", "jquery.inputmask.bundle.min.js", "jquery.inputmask.min.js", "vue-multiselect.min.js", "ractive.min.js", "BizCharts.min.js", "to-markdown.min.js", "turndown.js", "lokijs.min.js", "ckeditor.min.js", "js/material-kit.min.js", "autosuggest.min.js", "animateplus.min.js", "layzr.min.js", "chance.min.js", "collect.min.js", "petite-vue.umd.js", "chromium/chromium_48x48.png", "react-big-calendar.min.js", "alasql.min.js", "raven.min.js", "director.min.js", "heatmap.min.js", "ckeditor.js", "shaka-player.compiled.js", "brython.min.js", "cjs/ts/golden-layout.min.js", "index.js", "plupload.min.js", "css/basscss.min.css", "assets/css/bootstrap.min.css", "whs.min.js", "ejs.min.js", "tablesaw.min.js", "prettify.min.js", "reflux.min.js", "ramjet.umd.min.js", "rellax.min.js", "clappr.min.js", "vuex-persistedstate.js", "jexcel.min.js", "randomColor.min.js", "ui-grid.min.js", "core/deck.core.min.js", "css/ibm-type.min.css", "ng-grid.min.js", "js/fuelux.min.js", "scrollama.min.js", "iframeResizer.min.js", "flubber.min.js", "redux-logger.js", "ng2-bootstrap.umd.min.js", "instantclick.min.js", "loading-bar.min.js", "jsnes.min.js", "jquery.lettering.min.js", "seamless-immutable.production.min.js", "carbon-components.min.js", "jsencrypt.min.js", "js/jquery.atwho.min.js", "rough-notation.cjs.js", "scripts/shCore.min.js", "snabbt.min.js", "split.min.js", "zrender.min.js", "gitalk.min.js", "nouislider.min.js", "diff.min.js", "bignumber.min.js", "js/bootstrap-switch.min.js", "places.min.js", "css/buttons.min.css", "jquery.knob.min.js", "dinero.min.js", "cssgram.min.css", "billboard.min.js", "js/fileinput.min.js", "aphrodite.min.js", "APlayer.min.js", "smooth-scroll.min.js", "js/bootstrap-modalmanager.min.js", "hogan.min.js", "openpgp.min.js", "jquery.form.min.js", "moon.min.js", "js/epoch.min.js", "js/lightbox.min.js", "flexslider.min.css", "chardinjs.min.js", "lightgallery.min.js", "js-yaml.min.js", "tinycon.min.js", "jsmpg.min.js", "bootbox.min.js", "tufte.min.css", "cubism.v1.min.js", "jstree.min.js", "evil-icons.min.js", "remarkable.min.js", "js/lightgallery.min.js", "vue-strap.min.js", "js/froala_editor.min.js", "jquery.colorbox-min.js", "lib/simditor.min.js", "autotrack.js", "keras.js", "jquery.fitvids.min.js", "autosize.min.js", "bundled.js", "chart.d.ts", "tui-chart.min.js", "choices.min.js", "upup.min.js", "balloon.min.css", "instantpage.min.js", "oboe-browser.min.js", "jquery.stellar.min.js", "rp.js", "pts.min.js", "benchmark.min.js", "intercooler.min.js", "flowtype.min.js", "simplebar.min.js", "hello.js", "script/soundmanager2-nodebug-jsmin.js", "jquery.qrcode.min.js", "spritejs.min.js", "tota11y.min.js", "doT.min.js", "sanitize.min.css", "move.min.js", "globalize.min.js", "bespoke.min.js", "csslint.js", "jplayer/jquery.jplayer.min.js", "granim.min.js", "sir-trevor.min.js", "analytics.min.js", "san.min.js", "js/jquery-weui.min.js", "Vibrant.min.js", "bricks.min.js", "pico.min.css", "retina.min.js", "lib/js/emojione.min.js", "json5.min.js", "tui-image-editor.min.js", "js/tabulator.min.js", "xss.min.js", "js/mui.min.js", "jquery.smoothState.min.js", "react-day-picker.min.js", "react-quill.min.js", "sugar.min.js", "open-color.min.css", "ethers.umd.min.js", "elasticsearch.min.js", "axe.min.js", "opal.min.js", "opal-parser.min.js", "js/bootstrap-tour.min.js", "fixed-data-table.min.js", "alertify.min.js", "sprint.min.js", "flexibility.js", "squire.js", "elemental.min.js", "mixitup.min.js", "js/epiceditor.min.js", "css/topcoat-mobile-dark.min.css", "js/stroll.min.js", "decimal.min.js", "jquery.unveil.min.js", "htmlminifier.min.js", "js/hopscotch.min.js", "RecordRTC.min.js", "index.min.js", "jquery.mask.min.js", "timeago.min.js", "forge.min.js", "dash.all.min.js", "js/elfinder.min.js", "js/md5.min.js", "gl-matrix-min.js", "octokit-rest.min.js", "min/tiny-slider.js", "csshake.min.css", "jquery.bxslider.min.js", "css/Jcrop.gif", "load-image.min.js", "head.min.js", "css-doodle.min.js", "jquery.peity.min.js", "vue-select.js", "resumable.min.js", "emmet.cjs.js", "devicon.min.css", "responsive-nav.min.js", "js/jquery.okayNav-min.js", "tern.min.js", "next.min.js", "react-data-grid.min.js", "jquery.placeholder.min.js", "js/ui.min.js", "js/messenger.min.js", "jquery.mCustomScrollbar.min.js", "JsBarcode.all.min.js", "prop-types.min.js", "jquery.touchSwipe.min.js", "react-leaflet.min.js", "regl.min.js", "index.js", "gridstack.min.js", "textAngular.min.js", "zoom.min.js", "jquery.backstretch.min.js", "firebase-app.js", "yui/yui-min.js", "icono.min.css", "jquery.nestable.min.js", "lite-yt-embed.js", "ElementQueries.min.js", "qunit.min.js", "bitcoinjs-min.js", "vue-chartjs.min.js", "topojson.min.js", "quagga.min.js", "soundjs.min.js", "epub.min.js", "pubsub.min.js", "Imager.min.js", "kinetic.min.js", "custom-elements-es5-adapter.js", "vue-meta.cjs.js", "jquery.mousewheel.min.js", "gitment.browser.js", "jquery.timeago.min.js", "prefixfree.min.js", "jquery.pagepiling.min.js", "sketch.min.js", "content-tools.min.js", "js/animsition.min.js", "exif.min.js", "planck.min.js", "jsondiffpatch.umd.js", "peg.min.js", "gifshot.min.js", "js/jquery.ztree.all.min.js", "draggabilly.pkgd.min.js", "labella.min.js", "packery.pkgd.min.js", "index.umd.min.js", "glamorous.umd.min.js", "device.min.js", "amplitude.min.js", "mobile-detect.min.js", "fontfaceobserver.standalone.js", "gif.js", "vega-lite.min.js", "helium.min.js", "rythm.min.js", "mvp.css", "sw-toolbox.js", "960.min.css", "moment-timezone.min.js", "pako.min.js", "rsvp.min.js", "index.min.js", "stacktrace.min.js", "enquire.min.js", "jquery.payment.min.js", "canvas-nest.js", "anijs-min.js", "midnight.jquery.min.js", "vizceral.min.js", "tabletop.min.js", "pnotify.js", "recorder.min.js", "ng-cordova.min.js", "grade.min.js", "trumbowyg.min.js", "imask.min.js", "jquery.scrollTo.min.js", "outdatedbrowser.min.js", "all.min.js", "jquery.nicescroll.min.js", "js/blueimp-gallery.min.js", "tinycolor.min.js", "joint.min.js", "pivot.min.js", "js/bootstrap-datetimepicker.min.js", "dist/device-mockups.min.css", "angular-file-upload.min.js", "scribbletune.js", "jquery.textillate.min.js", "hashids.min.js", "modern-normalize.min.css", "alt.min.js", "maptalks.min.js", "prototype.min.js", "gmail.min.js", "js/bootstrap-multiselect.min.js", "picnic.min.css", "index.js", "polyglot.min.js", "datamaps.all.min.js", "big.min.js", "js/rrssb.min.js", "when.min.js", "viz.js", "jump.min.js", "web-animations.min.js", "basicScroll.min.js", "smoothscroll.min.js", "responsiveslides.min.js", "js/social-share.min.js", "jquery.vide.min.js", "jquery.ui.touch-punch.min.js", "vonic.min.js", "basket.full.min.js", "jquery.sticky.min.js", "underscore.string.min.js", "caman.full.min.js", "waves.min.js", "fitty.min.js", "jquery.autocomplete.min.js", "physicsjs.min.js", "opentype.min.js", "reconnecting-websocket.min.js", "ScrollTrigger.min.js", "wysihtml.min.js", "compressor.min.js", "select.min.js", "highland.min.js", "htmlgl.min.js", "incremental-dom-min.js", "instafeed.min.js", "most.min.js", "jquery.datetimepicker.full.min.js", "react-ace.js/main.js", "autoComplete.min.js", "pdf-lib.min.js", "zuck.min.js", "parallax.min.js", "leaflet.markercluster.js", "GitHub.min.js", "mori.min.js", "zone.min.js", "scrollMonitor.js", "font/css/open-iconic.min.css", "d3.layout.cloud.min.js", "mammoth.browser.min.js", "vexflow-min.js", "styles/salesforce-lightning-design-system.min.css", "tweenjs.min.js", "fingerprint.min.js", "background-check.min.js", "js/rainbow.min.js", "js/ngDialog.min.js", "react-flip-move.min.js", "vivagraph.min.js", "rivets.min.js", "cannon.min.js", "openlocationcode.min.js", "midi.min.js", "keypress.min.js", "js/mdui.min.js", "bootstrap-treeview.min.js", "svg4everybody.min.js", "melonjs.min.js", "bodyScrollLock.min.js", "feature.min.js", "survey.angular.min.js", "survey.jquery.min.js", "survey.ko.min.js", "survey.react.min.js", "survey.vue.min.js", "swig.min.js", "voca.min.js", "dialog.js", "jquery.matchHeight-min.js", "baobab.js", "vuefire.min.js", "xdomain.min.js", "gridjs.production.min.js", "umd.js"}

func LinkFinder(source string) ([]string, error) {
	var links []string
	// source = strings.ToLower(source)
	if len(source) > 1000000 {
		source = strings.ReplaceAll(source, ";", ";\r\n")
		source = strings.ReplaceAll(source, ",", ",\r\n")
	}
	source = DecodeChars(source)

	match := linkFinderRegex.FindAllStringSubmatch(source, -1)
	for _, m := range match {
		matchGroup1 := utils.FilterNewLines(m[1])

		if matchGroup1 == "" || !LinkBlackList(matchGroup1) {
			continue
		}
		links = append(links, matchGroup1)
	}
	links = utils.RemoveDuplicateElement(links)
	return links, nil
}

func LinkBlackList(source string) bool {
	source = strings.ToLower(source)
	matched := linkFinderPass.MatchString(source)

	if matched {
		return false
	}

	for _, i := range JsBlackList {
		if strings.Contains(source, i) {
			return false
		}
	}

	return true
}

func GetAWSS3(source string) []string {
	var aws []string

	for _, match := range AWSS3.FindAllStringSubmatch(source, -1) {
		aws = append(aws, DecodeChars(match[0]))
	}
	return aws
}

//转义处理
func DecodeChars(s string) string {
	source, err := url.QueryUnescape(s)
	if err == nil {
		s = source
	}

	// In case json encoded chars
	replacer := strings.NewReplacer(
		`\u002f`, "/",
		`\u0026`, "&",
	)
	s = replacer.Replace(s)
	return s
}
